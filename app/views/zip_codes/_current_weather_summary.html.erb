<!-- app/view/zip_codes/_current_weather_summary.html.erb -->

<section class="current-weather-summary group">

  <figure class="icon">
    <%= image_tag top_weather_condition_icon(zip_code).url(:thumbnail) %>
  </figure>

  <section class="stats">
    <%= link_to zip_code.city, zip_code_url(zip_code) %> <a
    href="#"
    id="<%= zip_code.id %>"
    data-remote="true"
    class="favorite summary-partial<% if signed_in? && current_user.favorite_zip_code_ids.include?(zip_code.id) %>
      <%= true %>
    <% else %>
      <%= false %>
    <% end %>">
    &#9733;
  </a>
    <br>
    <%= zip_code.current_temperature(current_user.try(:celsius)) %> &deg;
    <%= current_user.try(:celsius) ? "C" : "F" %>
    <%= zip_code.top_three_conditions.first.first %>
  </section>

</section>

<script type="text/javascript" charset="utf-8">
  var changeStarToFavorited = function (element) {
    $(element).addClass("true");
    $(element).removeClass("false");
  };

  var changeStarToUnfavorited = function (element) {
    $(element).removeClass("true");
    $(element).addClass("false");
  };

  $(document).ready(function(){
    $(".favorite-form").addClass("hidden");

    $(".current-weather-summary").on("click","a.favorite#<%= zip_code.id %>", function(event) {
      event.preventDefault();
      var that = this;

      if ($(this).hasClass("true")) {
        $.ajax({
          url: '<%= modify_favorite_zip_code_links_url + "?zip_code_id=#{zip_code.id}" %>',
          type: "DELETE",
          success: changeStarToUnfavorited(that)
        });
      } else {
        $.ajax({
          url: '<%= modify_favorite_zip_code_links_url + "?zip_code_id=#{zip_code.id}" %>',
          type: "POST",
          success: changeStarToFavorited(that)
        });
      };
    });
  });
</script>